## 前言
> 该脚本为自用脚本，主要用于清日常。

实现方式基于Open CV模板匹配，模板图基于960x540的设备, 具体对设备支持情况见[设备支持情况](#设备支持情况)。

## 一点变化
该脚本工程是在国服开放初期创建的，目前游戏在四周年版本中已经由官方支持了自动任务（不幸的是我还在玩这个游戏）。考虑现有工程中有大量无效或无价值的任务代码，所以决定对工程进行一些精简，现在它将变得只专注于一键清理日常。

## 使用引导

* 安装Python3环境，访问[Python官网](https://www.python.org/)安装
* 使用git clone或在网页上下载本项目到电脑中解压缩
  ```cmd
  git clone --depth 1 git@github.com:Gibberer/pcr-script.git
  ```
* 在命令行中执行以下命令安装项目所需依赖
  ```cmd
  pip install opencv_python numpy pywin32 PyYAML
  ```
* 设置配置文件：修改[_daily_config.yml](_daily_config.yml)中的雷电模拟器路径，之后将该文件重命名为**daily_config.yml**。
  * 如果是其他模拟器可以不设置路径，不过需要保证本机ADB命令可用，脚本会尝试使用ADB命令与设备交互，当然还请注意保持模拟器分辨率为960x540。
* 执行[daily_task.bat](daily_task.bat)或[daily_task.py](daily_task.py)来启动脚本程序。
  * 运行后会按如下方式进行:启动模拟器->启动游戏->执行脚本任务
---
* dialy_task仅支持单设备单账号并且处于已登录状态，如果需要多账号多设备可以使用[main.py](main.py)。不过在该文件中缺少对时限任务的判断，需要注意配置文件中的任务组合方式。
* 对MuMu模拟器12做了支持，可以通过[MuMuSimulator](pcrscript/simulator.py#L63)获取到Driver，Driver可以用于模拟器设备交互。
* 部分任务需要依赖冒险图中的角色形象，默认使用6星佩可莉姆。如果是其他角色可以在游戏内冒险地图界面截取其中角色图像中的一部分（最好是脸部，不要截取到地图背景），将新截取的图片替换掉[images/character.png](images/character.png)这个图片即可。

## 关于任务内容

该部分请查看[_daily_config.yml](_daily_config.yml)文件中的任务列表部分，脚本会按其中所列顺序依次执行每个任务条目，具体任务条目的用途请看文件中的注释部分。

### 关于时限任务

时限任务会在[daily_task.py](daily_task.py)中进行判断，如果对应任务的活动当前未开放，则会将配置的任务条目废弃掉不允执行。

## 设备支持情况

脚本定义数据基于960x540分辨率的雷电模拟器，如果不是相同情况则可能有无法运行的问题，具体参考如下：

**分辨率**
* *960x540* 支持（经测试）
* *1920x1080* 支持（经测试）
* *小于960x540* 支持（推测）
* *大于960x540* 支持（推测）
* *比例不是16:9* 概率支持（推测，仅全面屏手机这种程度的比例变化支持的可能性很高）
---
**模拟器/设备**
* *雷电模拟器* 支持/使用模拟器API（经测试）
* *MUMU12* 支持/使用模拟器API （经测试）
* *其他模拟器* 支持/需要ADB命令可用 （推测，如果模拟器ADB不是默认端口的话需要修改代码）
* *真机* 支持/需要ADB命令可用 （推测）
---
**其他**
* *Windows多屏幕支持* （经测试，运行过程中调整模拟器所在屏幕无影响）

